# Enterprise Document Search - High-Level Architecture (HLD)

## System Overview
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           ENTERPRISE DOCUMENT SEARCH SYSTEM                           │
│                                                                                       │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐                  │
│  │                 │    │                 │    │                 │                  │
│  │   Web Client    │    │  Mobile Client  │    │  External APIs  │                  │
│  │   (React/Vue)   │    │   (iOS/Android) │    │   (Partners)    │                  │
│  │                 │    │                 │    │                 │                  │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘                  │
│           │                       │                       │                         │
│           └───────────────────────┼───────────────────────┘                         │
│                                   │                                                 │
│  ═════════════════════════════════════════════════════════════════════════════════  │
│                                 API GATEWAY                                          │
│  ═════════════════════════════════════════════════════════════════════════════════  │
│                                   │                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                            LOAD BALANCER                                        │ │
│  │                          (HAProxy/Nginx)                                       │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                   │                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                        APPLICATION LAYER                                       │ │
│  │                                                                               │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │ │
│  │  │              │  │              │  │              │  │              │      │ │
│  │  │   App Inst   │  │   App Inst   │  │   App Inst   │  │   App Inst   │      │ │
│  │  │      #1      │  │      #2      │  │      #3      │  │      #4      │      │ │
│  │  │              │  │              │  │              │  │              │      │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘      │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                   │                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                         SERVICES LAYER                                         │ │
│  │                                                                               │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │ │
│  │  │             │  │             │  │             │  │             │          │ │
│  │  │    Redis    │  │ Elasticsearch│  │    Kafka    │  │   Storage   │          │ │
│  │  │   (Cache)   │  │   (Search)  │  │ (Messaging) │  │    (S3)     │          │ │
│  │  │             │  │             │  │             │  │             │          │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘          │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                   │                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                         DATA LAYER                                             │ │
│  │                                                                               │ │
│  │  ┌─────────────┐                           ┌─────────────┐                    │ │
│  │  │             │                           │             │                    │ │
│  │  │   MySQL     │◄──────────────────────────┤   MySQL     │                    │ │
│  │  │  (Master)   │                           │  (Replica)  │                    │ │
│  │  │             │                           │             │                    │ │
│  │  └─────────────┘                           └─────────────┘                    │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                       MONITORING & OBSERVABILITY                               │ │
│  │                                                                               │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │ │
│  │  │             │  │             │  │             │  │             │          │ │
│  │  │ Prometheus  │  │   Grafana   │  │    ELK      │  │   Jaeger    │          │ │
│  │  │ (Metrics)   │  │(Dashboard)  │  │(Logging)    │  │(Tracing)    │          │ │
│  │  │             │  │             │  │             │  │             │          │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘          │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Application Layer Architecture
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                     SPRING BOOT APPLICATION INSTANCE                                  │
│                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                          SECURITY LAYER                                          │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │   CORS      │  │  JWT Auth   │  │   Spring    │  │   Role      │            │ │
│  │  │  Filter     │  │   Filter    │  │  Security   │  │   Based     │            │ │
│  │  │             │  │             │  │             │  │   Access    │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                       CONTROLLER LAYER                                           │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │    Auth     │  │  Document   │  │    File     │  │   Health    │            │ │
│  │  │ Controller  │  │ Controller  │  │ Controller  │  │ Controller  │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                        SERVICE LAYER                                             │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │    User     │  │  Document   │  │    File     │  │   Search    │            │ │
│  │  │  Service    │  │  Service    │  │ Processing  │  │  Service    │            │ │
│  │  │             │  │             │  │  Service    │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                      REPOSITORY LAYER                                            │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │    User     │  │  Document   │  │    JPA      │  │ Custom      │            │ │
│  │  │ Repository  │  │ Repository  │  │ Auditing    │  │ Queries     │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                        MODEL LAYER                                               │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │    User     │  │  Document   │  │    Role     │  │   Base      │            │ │
│  │  │   Entity    │  │   Entity    │  │    Enum     │  │  Entity     │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Multi-Tenant Architecture
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              TENANT ISOLATION                                         │
│                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                           CLIENT LAYER                                           │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │   Tenant    │  │   Tenant    │  │   Tenant    │  │   Tenant    │            │ │
│  │  │      A      │  │      B      │  │      C      │  │      D      │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│                                         ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                      APPLICATION LAYER                                           │ │
│  │                    (Shared Infrastructure)                                       │ │
│  │                                                                                 │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                    TENANT IDENTIFICATION                                     │ │ │
│  │  │                                                                             │ │ │
│  │  │    JWT Token ──► Extract User ──► Get TenantID ──► Apply Filter              │ │ │
│  │  │                                                                             │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│                                         ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                        DATA LAYER                                               │ │
│  │                     (Row Level Security)                                        │ │
│  │                                                                                 │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                      USERS TABLE                                            │ │ │
│  │  │ ┌─────┬─────────┬─────────┬───────────┬─────────────┬──────────────────────┐ │ │ │
│  │  │ │ ID  │ USERNAME│  EMAIL  │ TENANT_ID │   ROLES     │      ...             │ │ │ │
│  │  │ ├─────┼─────────┼─────────┼───────────┼─────────────┼──────────────────────┤ │ │ │
│  │  │ │  1  │ user1   │user1@.. │ tenant-a  │ USER        │      ...             │ │ │ │
│  │  │ │  2  │ user2   │user2@.. │ tenant-b  │ USER        │      ...             │ │ │ │
│  │  │ │  3  │ admin1  │admin@.. │ tenant-a  │ ADMIN       │      ...             │ │ │ │
│  │  │ └─────┴─────────┴─────────┴───────────┴─────────────┴──────────────────────┘ │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │  │                                                                             │ │ │
│  │  │                   DOCUMENTS TABLE                                           │ │ │
│  │  │ ┌─────┬─────────┬─────────┬───────────┬─────────────┬──────────────────────┐ │ │ │
│  │  │ │ ID  │  TITLE  │ CONTENT │ TENANT_ID │   AUTHOR    │      ...             │ │ │ │
│  │  │ ├─────┼─────────┼─────────┼───────────┼─────────────┼──────────────────────┤ │ │ │
│  │  │ │  1  │ Doc A1  │ ...     │ tenant-a  │ user1       │      ...             │ │ │ │
│  │  │ │  2  │ Doc B1  │ ...     │ tenant-b  │ user2       │      ...             │ │ │ │
│  │  │ │  3  │ Doc A2  │ ...     │ tenant-a  │ admin1      │      ...             │ │ │ │
│  │  │ └─────┴─────────┴─────────┴───────────┴─────────────┴──────────────────────┘ │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────────────────────┐
    │                          QUERY FILTERING                                         │
    │                                                                                 │
    │  Original Query: SELECT * FROM documents WHERE title LIKE '%search%'            │
    │                                                                                 │
    │  Filtered Query: SELECT * FROM documents                                        │
    │                  WHERE title LIKE '%search%'                                   │
    │                  AND tenant_id = 'current-user-tenant'                         │
    │                                                                                 │
    └─────────────────────────────────────────────────────────────────────────────────┘
```

## Security Architecture
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              SECURITY LAYERS                                          │
│                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                        NETWORK SECURITY                                          │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │     WAF     │  │   HTTPS/    │  │    Rate     │  │   DDoS      │            │ │
│  │  │ (Firewall)  │  │    TLS      │  │  Limiting   │  │ Protection  │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                     APPLICATION SECURITY                                        │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │    JWT      │  │    Spring   │  │    CORS     │  │   Input     │            │ │
│  │  │ Validation  │  │  Security   │  │ Protection  │  │ Validation  │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                      DATA SECURITY                                              │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │  Encryption │  │   Tenant    │  │    Row      │  │  Audit      │            │ │
│  │  │  at Rest    │  │ Isolation   │  │   Level     │  │ Logging     │            │ │
│  │  │             │  │             │  │  Security   │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow Architecture
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                               DATA FLOW                                               │
│                                                                                       │
│    ┌─────────────┐           ┌─────────────┐           ┌─────────────┐               │
│    │             │  HTTP     │             │   JPA     │             │               │
│    │   Client    │──────────▶│ Spring Boot │──────────▶│   MySQL     │               │
│    │             │ Requests  │ Application │ Queries   │  Database   │               │
│    │             │◄──────────│             │◄──────────│             │               │
│    └─────────────┘  JSON     └─────────────┘  Results  └─────────────┘               │
│                     Response        │                          │                     │
│                                     │                          │                     │
│                                     ▼                          ▼                     │
│                              ┌─────────────┐           ┌─────────────┐               │
│                              │             │           │             │               │
│                              │    Redis    │           │ File System │               │
│                              │   (Cache)   │           │  (Uploads)  │               │
│                              │             │           │             │               │
│                              └─────────────┘           └─────────────┘               │
│                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                          PROCESSING PIPELINE                                     │ │
│  │                                                                                 │ │
│  │    File Upload ──► Validation ──► Content Extraction ──► Database Storage       │ │
│  │         │              │                  │                      │             │ │
│  │         ▼              ▼                  ▼                      ▼             │ │
│  │   Size Check    Type Check      Apache Tika       Document Entity Creation      │ │
│  │   Format Check  Security Check  Text Extraction   Metadata Storage            │ │
│  │                                                                                 │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Deployment Architecture
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           DEPLOYMENT ENVIRONMENTS                                     │
│                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                         DEVELOPMENT                                              │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                              │ │
│  │  │             │  │             │  │             │                              │ │
│  │  │   Local     │  │     H2      │  │    Local    │                              │ │
│  │  │   Server    │  │  Database   │  │    Files    │                              │ │
│  │  │             │  │             │  │             │                              │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                              │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                          STAGING                                                │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │   Docker    │  │    MySQL    │  │    Redis    │  │     S3      │            │ │
│  │  │ Container   │  │  Database   │  │   Cache     │  │   Storage   │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                        PRODUCTION                                               │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │ Kubernetes  │  │   RDS/      │  │ ElastiCache │  │     S3      │            │ │
│  │  │   Cluster   │  │  Aurora     │  │   Redis     │  │   Storage   │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │ Monitoring  │  │   Logging   │  │   Metrics   │  │   Alerts    │            │ │
│  │  │  (Jaeger)   │  │    (ELK)    │  │(Prometheus) │  │ (PagerDuty) │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Integration Architecture
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            EXTERNAL INTEGRATIONS                                      │
│                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                         UPSTREAM SERVICES                                        │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │   Identity  │  │  External   │  │  Content    │  │  Notification│            │ │
│  │  │  Provider   │  │    APIs     │  │  Sources    │  │   Service   │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│                                         ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                      ENTERPRISE DOCUMENT SEARCH                                 │ │
│  │                                                                                 │ │
│  │                        ┌─────────────────────┐                                 │ │
│  │                        │                     │                                 │ │
│  │                        │   API Gateway       │                                 │ │
│  │                        │   - Rate Limiting   │                                 │ │
│  │                        │   - Authentication  │                                 │ │
│  │                        │   - Load Balancing  │                                 │ │
│  │                        │                     │                                 │ │
│  │                        └─────────────────────┘                                 │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                            │
│                                         ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                       DOWNSTREAM SERVICES                                       │ │
│  │                                                                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  │  Analytics  │  │  Reporting  │  │  Archival   │  │   Backup    │            │ │
│  │  │   Service   │  │   Service   │  │  Service    │  │   Service   │            │ │
│  │  │             │  │             │  │             │  │             │            │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Key Architectural Principles

### 1. Scalability
- **Horizontal Scaling**: Multiple application instances behind load balancer
- **Database Scaling**: Master-slave replication for read scaling
- **Caching**: Redis for frequently accessed data
- **CDN**: Static content delivery for global reach

### 2. Security
- **Multi-layer Security**: Network, application, and data layer protection
- **Zero Trust**: Every request validated and authorized
- **Encryption**: Data encrypted in transit and at rest
- **Tenant Isolation**: Strict data separation between tenants

### 3. Reliability
- **High Availability**: Multi-instance deployment with failover
- **Circuit Breakers**: Prevent cascade failures
- **Health Checks**: Continuous monitoring and auto-recovery
- **Backup & Recovery**: Automated backup with point-in-time recovery

### 4. Observability
- **Logging**: Structured logging with correlation IDs
- **Metrics**: Comprehensive metrics collection
- **Tracing**: Distributed tracing for request flow
- **Monitoring**: Real-time alerting and dashboards

### 5. Performance
- **Caching Strategy**: Multi-level caching (application, database, CDN)
- **Connection Pooling**: Optimized database connections
- **Async Processing**: Non-blocking file processing
- **Query Optimization**: Efficient database queries with proper indexing